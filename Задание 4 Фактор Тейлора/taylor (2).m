clear all 
close all 
deg=pi/180;

dfpln=[1	0	1;...
       1	1	0;...
       0	-1	1;...
       1	0	1;...
       0	1	1;...
       1	-1	0;...
       1	1	0;...
       0	1	1;...
       -1	0	1;...
        1	-1	0;...
        0	-1	1;...
        -1	0	1] ;

dfdir=[-1	1	1;...
       -1   1   1;...
       -1   1   1;...
        -1  -1  1;...
        -1  -1  1;...
        -1  -1  1;...
         1  -1  1;... 
         1 -1 1;...
         1 -1 1;...
        1 1 1;...
        1 1 1;...
        1 1 1];

% dfdir=[1	0	1;...
% 1	0	1;...
% 1	1	0;...
% 1	1	0;...
% 0	1	1;...
% 0	1	1;...
% 1	-1	0;...
% 1	-1	0;...
% 0	-1	1;...
% 0	-1	1;...
% -1	0	1;...
% -1	0	1] ;
% dfpln=[-1	1	1;...
%     -1 -1 1;...
%     1 -1 1;...
%     -1 1 1;...
%     -1 -1 1;...
%     1 -1 1;...
%     -1 -1 1;...
%     1 1 1;...
%     -1 1 1;...
%     1 1 1;...
%     1 -1 1;...
%     1 1 1];





sum(dfpln.*dfdir,2)
for k=1:length(dfpln)
    for i=1:3
        for j=1:3
            G(k,i,j)=0.5*(dfpln(k,i).*dfdir(k,j) + dfpln(k,j).*dfdir(k,i)); 

        end
    end
end

e11=1; 
es = [e11 0 0;
      0 0 0;
      0 0 -e11];
G(:,1,1)

nn=length(dfpln);  
tcrit=ones(nn,1)' 
lb(1:nn)=-e11; 
ub(1:nn)=e11;

i=1
for Phi=0:10:90 
    for phi1=0:10:90 
        phi2=0*deg;
        ec=g(phi1*deg,Phi*deg,phi2*deg)*es*g(phi1*deg,Phi*deg,phi2*deg)';


        A=[G(:,1,1)';
           G(:,2,2)';
           G(:,1,2)';
           G(:,1,3)';
           G(:,2,3)'];
        b=[ec(1,1),ec(2,2),ec(1,2),ec(1,3),ec(2,3)]; 
       
        b
        c=tcrit; 
        shears(:,i)=linprog(c,[],[],A,b,lb,ub); 
        for m = find (shears==-e11); shears(m)=0; end	
        for m = find (shears==e11); shears(m)=0; end 
        i=i+1;
    end 
end 
shears(1,1);
m_cryst = sum(abs(shears),1)/ e11 
M = mean(m_cryst, 'all')

function R = g(f1,f2,f3)     
    R=[cos(f1)*cos(f3)-cos(f2)*sin(f1)*sin(f3)   cos(f3)*sin(f1)+cos(f1)*cos(f2)*sin(f3)   sin(f2)*sin(f3);...
       -cos(f2)*cos(f3)*sin(f1)-cos(f1)*sin(f3)   cos(f1)*cos(f2)*cos(f3)-sin(f1)*sin(f3)    cos(f3)*sin(f2);...
       sin(f1)*sin(f2)                           -cos(f1)*sin(f2)                            cos(f2)];
end